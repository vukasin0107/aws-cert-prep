<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>02. EC2 Storage - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="navitem">
                                <a href="../01.%20EC2/" class="nav-link">01. EC2</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">02. EC2 Storage</a>
                            </li>
                            <li class="navitem">
                                <a href="../03.%20ELB%20and%20ASG/" class="nav-link">03. ELB and ASG</a>
                            </li>
                            <li class="navitem">
                                <a href="../04.%20RDS-Aurora-ElastiCache/" class="nav-link">04. RDS Aurora ElastiCache</a>
                            </li>
                            <li class="navitem">
                                <a href="../05.%20Databases/" class="nav-link">05. Databases</a>
                            </li>
                            <li class="navitem">
                                <a href="../10.%20AWS%20Organizations/" class="nav-link">10. AWS Organizations</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../01.%20EC2/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../03.%20ELB%20and%20ASG/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<ol>
<li>EBS Volume 
An EBS (Elastic Block Store) Volume is a network drive you can attach to your instances while they run.</li>
<li>It allows your instances to persist data, even after their termination</li>
<li>They can only be mounted to one instance at a time (at the CCP level)</li>
<li>They are bound to a specific availability zone</li>
<li>Analogy: Think of them as a “network USB stick”</li>
<li>
<p>Free tier: 30 GB of free EBS storage of type General Purpose (SSD) or Magnetic per month</p>
</li>
<li>
<p>It’s a network drive (i.e. not a physical drive)</p>
</li>
<li>It uses the network to communicate the instance, which means there might be a bit of latency</li>
<li>It can be detached from an EC2 instance and attached to another one quickly</li>
<li>It’s locked to an Availability Zone (AZ)</li>
<li>An EBS Volume in us-east-1a cannot be attached to us-east-1b</li>
<li>To move a volume across, you first need to snapshot it</li>
<li>Have a provisioned capacity (size in GBs, and IOPS)</li>
<li>You get billed for all the provisioned capacity</li>
<li>
<p>You can increase the capacity of the drive over time</p>
</li>
<li>
<p>EBS – Delete on Termination attribute:
    Controls the EBS behaviour when an EC2 instance terminates</p>
<ul>
<li>By default, the root EBS volume is deleted (attribute enabled)</li>
<li>By default, any other attached EBS volume is not deleted (attribute disabled)</li>
<li>This can be controlled by the AWS console / AWS CLI</li>
<li>Use case: preserve root volume when instance is terminated</li>
</ul>
</li>
<li>
<p>EBS Snapshots</p>
</li>
<li>Make a backup (snapshot) of your EBS volume at a point in time</li>
<li>Not necessary to detach volume to do snapshot, but recommended</li>
<li>
<p>Can copy snapshots across AZ or Region</p>
</li>
<li>
<p>EBS Snapshots Features</p>
</li>
<li><strong>EBS Snapshot Archive</strong><ul>
<li>Move a Snapshot to an ”archive tier” that is 75% cheaper</li>
<li>Takes within 24 to 72 hours for restoring the archive</li>
</ul>
</li>
<li><strong>Recycle Bin for EBS Snapshots</strong><ul>
<li>Setup rules to retain deleted snapshots so you can recover them after an accidental deletion</li>
<li>Specify retention (from 1 day to 1 year)</li>
</ul>
</li>
<li>
<p><strong>Fast Snapshot Restore (FSR)</strong></p>
<ul>
<li>Force full initialization of snapshot to have no latency on the first use ($$$)</li>
</ul>
</li>
<li>
<p>AMI Overview
AMI = Amazon Machine Image</p>
</li>
<li>AMI are a customization of an EC2 instance</li>
<li>You add your own software, configuration, operating system, monitoring…</li>
<li>Faster boot / configuration time because all your software is pre-packaged</li>
<li>AMI are built for a specific region (and can be copied across regions)</li>
<li>You can launch EC2 instances from:</li>
<li>A Public AMI: AWS provided</li>
<li>Your own AMI: you make and maintain them yourself</li>
<li>
<p>An AWS Marketplace AMI: an AMI someone else made</p>
<p><strong>AMI Process (from an EC2 instance)</strong>
- Start an EC2 instance and customize it
- Stop the instance (for data integrity)
- Build an AMI – this will also create EBS snapshots
- Launch instances from other AMIs</p>
</li>
<li>
<p>EC2 Instance Store</p>
</li>
<li>EBS volumes are network drives with good but “limited” performance</li>
<li>If you need a high-performance hardware disk, use EC2 Instance Store</li>
<li>Better I/O performance</li>
<li>EC2 Instance Store lose their storage if they’re stopped (ephemeral)</li>
<li>Good for buffer / cache / scratch data / temporary content</li>
<li>Risk of data loss if hardware fails</li>
<li>
<p>Backups and Replication are your responsibility</p>
</li>
<li>
<p>Local EC2 Instance Store<br />
<img alt="EC2 Instance Store" src="../img/ec2-instances-types.png" /></p>
</li>
<li>
<p>EBS Volume Types</p>
</li>
<li>EBS Volumes come in 6 types<ul>
<li>gp2 / gp3 (SSD): General purpose SSD volume that balances price and performance for a wide variety of workloads</li>
<li>io1 / io2 Block Express (SSD): Highest-performance SSD volume for mission-critical low-latency or high-throughput workloads</li>
</ul>
</li>
<li>st1 (HDD): Low cost HDD volume designed for frequently accessed, throughput- intensive workloads</li>
<li>
<p>sc1 (HDD): Lowest cost HDD volume designed for less frequently accessed workloads</p>
</li>
<li>
<p>EBS Volumes are characterized in Size | Throughput | IOPS (I/O Ops Per Sec)</p>
</li>
<li>When in doubt always consult the AWS documentation – it’s good!</li>
<li>
<p>Only gp2/gp3 and io1/io2 Block Express can be used as boot volumes</p>
</li>
<li>
<p>EBS Volume Types Use cases
General Purpose SSD</p>
</li>
<li>Cost effective storage, low-latency</li>
<li>System boot volumes, Virtual desktops, Development and test environments</li>
<li>1 GiB - 16 TiB</li>
<li>gp3:<ul>
<li>Baseline of 3,000 IOPS and throughput of 125 MiB/s</li>
<li>Can increase IOPS up to 16,000 and throughput up to 1000 MiB/s independently</li>
</ul>
</li>
<li>
<p>gp2:</p>
<ul>
<li>Small gp2 volumes can burst IOPS to 3,000</li>
<li>Size of the volume and IOPS are linked, max IOPS is 16,000</li>
<li>3 IOPS per GB, means at 5,334 GB we are at the max IOPS</li>
</ul>
</li>
<li>
<p>EBS Volume Types Use cases
Provisioned IOPS (PIOPS) SSD</p>
</li>
<li>Critical business applications with sustained IOPS performance</li>
<li>Or applications that need more than 16,000 IOPS</li>
<li>Great for databases workloads (sensitive to storage perf and consistency)</li>
<li>io1 (4 GiB - 16 TiB):<ul>
<li>Max PIOPS: 64,000 for Nitro EC2 instances &amp; 32,000 for other</li>
<li>Can increase PIOPS independently from storage size</li>
</ul>
</li>
<li>io2 Block Express (4 GiB – 64 TiB):<ul>
<li>Sub-millisecond latency</li>
<li>Max PIOPS: 256,000 with an IOPS:GiB ratio of 1,000:1</li>
</ul>
</li>
<li>
<p>Supports EBS Multi-attach </p>
</li>
<li>
<p>EBS Volume Types Use cases
Hard Disk Drives (HDD) </p>
</li>
<li>Cannot be a boot volume </li>
<li>125 GiB to 16 TiB </li>
<li>Throughput Optimized HDD (st1) <ul>
<li>Big Data, Data Warehouses, Log Processing </li>
<li>Max throughput 500 MiB/s – max IOPS 500 </li>
</ul>
</li>
<li>Cold HDD (sc1): <ul>
<li>For data that is infrequently accessed </li>
<li>Scenarios where lowest cost is important </li>
<li>Max throughput 250 MiB/s – max IOPS 250</li>
</ul>
</li>
</ol>
<p><em>Don't need to get all details but some top level differences, like which one to use to get the most IOPS at the lowest cost for a specific use case</em></p>
<ol>
<li>EBS Multi-Attach – io1/io2 family</li>
<li>Attach the same EBS volume to multiple EC2 instances in the same AZ</li>
<li>Each instance has full read &amp; write permissions to the high-performance volume</li>
<li>Use case:<ul>
<li>Achieve higher application availability in clustered Linux applications (ex: Teradata)</li>
<li>Applications must manage concurrent write operations</li>
</ul>
</li>
<li><strong>Up to 16 EC2 Instances at a time</strong></li>
<li>
<p>Must use a file system that’s cluster-aware (not XFS, EXT4, etc…) </p>
</li>
<li>
<p>EBS Encryption</p>
</li>
<li>When you create an encrypted EBS volume, you get the following:<ul>
<li>Data at rest is encrypted inside the volume</li>
<li>All the data in flight moving between the instance and the volume is encrypted</li>
<li>All snapshots are encrypted</li>
<li>All volumes created from the snapshot</li>
</ul>
</li>
<li>Encryption and decryption are handled transparently (you have nothing to do)</li>
<li>Encryption has a minimal impact on latency</li>
<li>EBS Encryption leverages keys from KMS (AES-256)</li>
<li>Copying an unencrypted snapshot allows encryption</li>
<li>
<p>Snapshots of encrypted volumes are encrypted</p>
</li>
<li>
<p>Encryption: encrypt an unencrypted EBS volume</p>
</li>
<li>Create an EBS snapshot of the volume</li>
<li>Encrypt the EBS snapshot ( using copy )</li>
<li>Create new ebs volume from the snapshot ( the volume will also be encrypted )</li>
<li>
<p>Now you can attach the encrypted volume to the original instance</p>
</li>
<li>
<p>Amazon EFS – Elastic File System</p>
</li>
<li>Managed NFS (network file system) that can be mounted on many EC2</li>
<li>EFS works with EC2 instances in multi-AZ</li>
<li>
<p>Highly available, scalable, expensive (3x gp2), pay per use</p>
</li>
<li>
<p>Amazon EFS – Elastic File System</p>
</li>
<li>Use cases: content management, web serving, data sharing, Wordpress</li>
<li>Uses NFSv4.1 protocol</li>
<li>Uses security group to control access to EFS</li>
<li>Compatible with Linux based AMI (not Windows)</li>
<li>Encryption at rest using KMS</li>
<li>POSIX file system (~Linux) that has a standard file API</li>
<li>
<p>File system scales automatically, pay-per-use, no capacity planning!</p>
</li>
<li>
<p>EFS – Performance &amp; Storage Classes</p>
</li>
<li>EFS Scale<ul>
<li>1000s of concurrent NFS clients, 10 GB+ /s throughput</li>
<li>Grow to Petabyte-scale network file system, automatically</li>
</ul>
</li>
<li>Performance Mode (set at EFS creation time)<ul>
<li>General Purpose (default) – latency-sensitive use cases (web server, CMS, etc…)</li>
<li>Max I/O – higher latency, throughput, highly parallel (big data, media processing)</li>
</ul>
</li>
<li>
<p>Throughput Mode</p>
<ul>
<li>Bursting – 1 TB = 50MiB/s + burst of up to 100MiB/s</li>
<li>Provisioned – set your throughput regardless of storage size, ex: 1 GiB/s for 1 TB storage</li>
<li>Elastic – automatically scales throughput up or down based on your workloads<ul>
<li>Up to 3GiB/s for reads and 1GiB/s for writes</li>
<li>Used for unpredictable workloads</li>
</ul>
</li>
</ul>
</li>
<li>
<p>EFS – Storage Classes</p>
</li>
<li>Storage Tiers (lifecycle management feature – move file after N days) <ul>
<li>Standard: for frequently accessed files </li>
<li>Infrequent access (EFS-IA): cost to retrieve files, lower price to store. Enable EFS-IA with a LifecyclePolicy</li>
</ul>
</li>
<li>Availability and durability <ul>
<li>Standard: Multi-AZ, great for prod </li>
<li>One Zone: One AZ, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)</li>
</ul>
</li>
<li>
<p>Over 90% in cost savings</p>
</li>
<li>
<p>EBS vs EFS – Elastic Block Storage</p>
</li>
<li>
<p>EBS volumes…</p>
<ul>
<li>one instance (except multi-attach io1/io2)</li>
<li>are locked at the Availability Zone (AZ) level</li>
<li>gp2: IO increases if the disk size increases</li>
<li>gp3 &amp; io1: can increase IO independently</li>
</ul>
</li>
<li>To migrate an EBS volume across AZ<ul>
<li>Take a snapshot</li>
<li>Restore the snapshot to another AZ</li>
<li>EBS backups use IO and you shouldn’t run them while your application is handling a lot of traffic</li>
</ul>
</li>
<li>
<p>Root EBS Volumes of instances get terminated by default if the EC2 instanc</p>
</li>
<li>
<p>EBS vs EFS – Elastic File System</p>
</li>
<li>Mounting 100s of instances across AZ</li>
<li>EFS share website files (WordPress)</li>
<li>Only for Linux Instances (POSIX)</li>
<li>EFS has a higher price point than EBS</li>
<li>Can leverage EFS-IA for cost savings</li>
<li>Remember: EFS vs EBS vs Instance Store</li>
</ol></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
